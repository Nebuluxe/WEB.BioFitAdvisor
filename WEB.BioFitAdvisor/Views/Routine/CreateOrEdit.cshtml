@using System.Collections.Generic
@using API.BioFitAdvisor.Domain
@model API.BioFitAdvisor.Domain.Routine

@{
    ViewData["Title"] = Model.RoutineId == 0 ? "Crear Rutina" : "Editar Rutina";
}

<h4 class="header-view">@ViewData["Title"]</h4>

<div class="container-section">

    <form asp-action="CreateOrEdit" method="post">
        <input type="hidden" asp-for="RoutineId" />
        <input type="hidden"  asp-for="UserId" />

        <div class="mb-3">
            <label asp-for="Name" class="form-label"></label>
            <input asp-for="Name" class="form-control" />
        </div>
        <div class="mb-3">
            <label asp-for="Description" class="form-label"></label>
            <textarea asp-for="Description" class="form-control"></textarea>
        </div>
        <div class="mb-3">
            <label asp-for="StartDate" class="form-label"></label>
            <input asp-for="StartDate" type="date" class="form-control" />
        </div>
        <div class="mb-3">
            <label asp-for="EndDate" class="form-label"></label>
            <input asp-for="EndDate" type="date" class="form-control" />
        </div>

        <h3>Dieta</h3>
        <button id="addDiet" class="btn btn-primary">Agregar Dieta</button>
        <table id="dietTable" class="table table-bordered mt-3">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Descripción</th>
                    <th>Calorías Diarias</th>
                    <th>Fecha de Inicio</th>
                    <th>Fecha de Fin</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                @for (int i = 0; i < Model.Diets.Count; i++)
                {
                    <tr>
                        <td><input type="text" name="Diets[@i].DietName" value="@Model.Diets[i].DietName" class="form-control" /></td>
                        <td><input type="text" name="Diets[@i].Description" value="@Model.Diets[i].Description" class="form-control" /></td>
                        <td><input type="number" name="Diets[@i].DailyCalories" value="@Model.Diets[i].DailyCalories" class="form-control" /></td>
                        <td><input type="date" name="Diets[@i].StartDate" value="@Model.Diets[i].StartDate.ToString("yyyy-MM-dd")" class="form-control" /></td>
                        <td><input type="date" name="Diets[@i].EndDate" value="@Model.Diets[i].EndDate.ToString("yyyy-MM-dd")" class="form-control" /></td>
                        <td><button type="button" class="btn btn-danger removeDiet">Quitar</button></td>
                    </tr>
                }
            </tbody>
        </table>

        <h3>Suplementación</h3>
        <button id="addSupplement" class="btn btn-primary">Agregar Plan de Suplementación</button>
        <table id="supplementTable" class="table table-bordered mt-3">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Descripción</th>
                    <th>Dosis</th>
                    <th>Frecuencia</th>
                    <th>Fecha de Inicio</th>
                    <th>Fecha de Fin</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                @for (int i = 0; i < Model.SupplementPlans.Count; i++)
                {
                    <tr>
                        <td><input type="text" name="SupplementPlans[@i].SupplementName" value="@Model.SupplementPlans[i].SupplementName" class="form-control" /></td>
                        <td><input type="text" name="SupplementPlans[@i].Description" value="@Model.SupplementPlans[i].Description" class="form-control" /></td>
                        <td><input type="text" name="SupplementPlans[@i].Dosage" value="@Model.SupplementPlans[i].Dosage" class="form-control" /></td>
                        <td><input type="text" name="SupplementPlans[@i].Frequency" value="@Model.SupplementPlans[i].Frequency" class="form-control" /></td>
                        <td><input type="date" name="SupplementPlans[@i].StartDate" value="@Model.SupplementPlans[i].StartDate.ToString("yyyy-MM-dd")" class="form-control" /></td>
                        <td><input type="date" name="SupplementPlans[@i].EndDate" value="@Model.SupplementPlans[i].EndDate.ToString("yyyy-MM-dd")" class="form-control" /></td>
                        <td><button type="button" class="btn btn-danger removeSupplement">Quitar</button></td>
                    </tr>
                }
            </tbody>
        </table>

        <h3>Workouts</h3>
        <button id="addWorkout" class="btn btn-primary">Agregar Workout</button>
        <table id="workoutTable" class="table table-bordered mt-3">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Descripción</th>
                    <th>Duración (minutos)</th>
                    <th>Frecuencia</th>
                    <th>Fecha de Inicio</th>
                    <th>Fecha de Fin</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                @for (int i = 0; i < Model.Exercises.Count; i++)
                {
                    <tr>
                        <td><input type="text" name="Exercises[@i].WorkoutName" value="@Model.Exercises[i].WorkoutName" class="form-control" /></td>
                        <td><input type="text" name="Exercises[@i].Description" value="@Model.Exercises[i].Description" class="form-control" /></td>
                        <td><input type="number" name="Exercises[@i].DurationMinutes" value="@Model.Exercises[i].DurationMinutes" class="form-control" /></td>
                        <td><input type="text" name="Exercises[@i].Frequency" value="@Model.Exercises[i].Frequency" class="form-control" /></td>
                        <td><input type="date" name="Exercises[@i].StartDate" value="@Model.Exercises[i].StartDate.ToString("yyyy-MM-dd")" class="form-control" /></td>
                        <td><input type="date" name="Exercises[@i].EndDate" value="@Model.Exercises[i].EndDate.ToString("yyyy-MM-dd")" class="form-control" /></td>
                        <td><button type="button" class="btn btn-danger removeWorkout">Quitar</button></td>
                    </tr>
                }
            </tbody>
        </table>

        <div class="d-flex justify-content-between">
            <input type="submit" value="Guardar" class="btn btn-primary" />
            <a asp-action="Index" class="btn btn-secondary">Cancelar</a>
        </div>
    </form>


</div>
@* @section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
} *@
@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // Agregar fila de dieta
        $('#addDiet').on('click', function (e) {
            e.preventDefault();
            let index = $('#dietTable tbody tr').length;
            let newRow = `<tr>
                        <td><input type="text" name="Diets[${index}].DietName" class="form-control" /></td>
                        <td><input type="text" name="Diets[${index}].Description" class="form-control" /></td>
                        <td><input type="number" name="Diets[${index}].DailyCalories" class="form-control" /></td>
                        <td><input type="date" name="Diets[${index}].StartDate" class="form-control" /></td>
                        <td><input type="date" name="Diets[${index}].EndDate" class="form-control" /></td>
                        <td><button type="button" class="btn btn-danger removeDiet">Quitar</button></td>
                    </tr>`;
            $('#dietTable tbody').append(newRow);
        });

        // Agregar fila de suplementación
        $('#addSupplement').on('click', function (e) {
            e.preventDefault();
            let index = $('#supplementTable tbody tr').length;
            let newRow = `<tr>
                        <td><input type="text" name="SupplementPlans[${index}].SupplementName" class="form-control" /></td>
                        <td><input type="text" name="SupplementPlans[${index}].Description" class="form-control" /></td>
                        <td><input type="text" name="SupplementPlans[${index}].Dosage" class="form-control" /></td>
                        <td><input type="text" name="SupplementPlans[${index}].Frequency" class="form-control" /></td>
                        <td><input type="date" name="SupplementPlans[${index}].StartDate" class="form-control" /></td>
                        <td><input type="date" name="SupplementPlans[${index}].EndDate" class="form-control" /></td>
                        <td><button type="button" class="btn btn-danger removeSupplement">Quitar</button></td>
                    </tr>`;
            $('#supplementTable tbody').append(newRow);
        });

        // Agregar fila de workout
        $('#addWorkout').on('click', function (e) {
            e.preventDefault();
            let index = $('#workoutTable tbody tr').length;
            let newRow = `<tr>
                        <td><input type="text" name="Exercises[${index}].WorkoutName" class="form-control" /></td>
                        <td><input type="text" name="Exercises[${index}].Description" class="form-control" /></td>
                        <td><input type="number" name="Exercises[${index}].DurationMinutes" class="form-control" /></td>
                        <td><input type="text" name="Exercises[${index}].Frequency" class="form-control" /></td>
                        <td><input type="date" name="Exercises[${index}].StartDate" class="form-control" /></td>
                        <td><input type="date" name="Exercises[${index}].EndDate" class="form-control" /></td>
                        <td><button type="button" class="btn btn-danger removeWorkout">Quitar</button></td>
                    </tr>`;
            $('#workoutTable tbody').append(newRow);
        });

        // Remover filas
        $(document).on('click', '.removeDiet', function () {
            $(this).closest('tr').remove();
        });

        $(document).on('click', '.removeSupplement', function () {
            $(this).closest('tr').remove();
        });

        $(document).on('click', '.removeWorkout', function () {
            $(this).closest('tr').remove();
        });
    </script>
}